---
title: TCP数据推送
date: 2021-5-5
comments: true
categories: 协议
tags: tcp
---

# TCP数据推送开发分享

**背景**：维景与数据中心的数据传输采用TCP方式，通过加密，按照数据中心的通讯协议封包发送。

**声明**：这是我工作中的开发经验，并不代表是现行最好的，或者标准的，甚至还有一些错误（BUG，欢迎指正）。但这也是本人在思考和查阅资料后得出的一套符合目前业务可行的方案，大家也可从中get一些收获。

***我希望***：*这篇文档算作抛砖引玉，希望大家发现错误，或者好的想法，可直接更改本文（但要做出说明，让再次看到文档的人明白改进的思想和方式），再次分享*。



## 一、资料以及代码

- 紫衡能源监测辅助系统（[网站传送门](http://218.17.122.50:8099/#/agreement)）

- gitlab（weijing-datapush-api）([网站传送门](http://118.190.88.23:8888/ganwei/weijing-data-push)）

## 二、遇到问题

1.如何封包

 

2.Socket超时



3.拆包



4.报文



5.HttpClient使用



6.AES加密



7.CRC校验



8.大小端





### 拓展

###### TCP释义

- TCP是流式传输，是连续的、非结构化的，这就像河里的水，源源不断，没有分界。
- TCP是面向连接的，在一个TCP连接中，仅有两方进行彼此通信。广播和多播不能用于TCP



###### TCP可靠性

- TCP将数据分段，保持首部和数据的检验和

- TCP具有确认和重发机制

- TCP会对失序数据重新排序

- TCP会对数据去重

- TCP还能提供流量控制

  

  

  

- 

  









![img](D:\chengqj\Documents\typora\image\201203221733242750.jpg)

 

 

###### TCP中的问题

- 超时

- 重传
- 粘包/半包



## 三、网站描述错误





## 四、有待改进之处

1.封包应该以面向对象的思想实现

2.接收报文可以考虑添加缓冲区

3.接收可以考虑用NIO

4.发送可以考虑事件驱动而不是轮询，并且睡眠会造成用户态和内核态的切换，操作很重

5.定时线程可以考虑用Schedule实现，这样时间就更规整

6.未考虑半包问题

7.异常信息不规范统一

8.CRC校验未验证

## 五、参考爽文

TCP封包 https://blog.csdn.net/yusiguyuan/article/details/17270571

关于TCP封包、粘包、半包 https://www.cnblogs.com/jiangtong/archive/2012/03/22/2411985.html